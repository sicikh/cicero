# Cicero DSL

## Файлы шаблона

### Файл types.cicero

В файле types.cicero, который хранится в папке шаблона, находятся все типы данных, которые будут или могут использоваться в шаблоне. Синтаксис описан ниже:

#### Описание структуры данных:

1. Структуры:

```rust
struct Person {
    name: String,
    surname: String,
    patronym: String?,
    place_of_living: Place,
    passport: Passport,
}
```

Структура Person, тип Place, Passport введены в стандартную библиотеку, чтобы в каждом шаблоне не повторяться.

Структура описывается как `struct ИмяСтруктуры { поле: ТипПоля, другое_поле: ТипПоля }`. Если поле может быть не заполнено, то к типу справа приписывается символ `?`.

Для того, чтобы пользователю прислать комментарий к заполняемому полю структуры, над полем структуры следует написать комментарий в следующем формате:

```rust
struct Person {
    /// # Заголовок
    /// ## Подзаголовок
    /// ### 
    /// 
    /// *Жирное начертание*, **курсивное начертание**.
    patronym: String?,
}
```

2. Перечисления

Если нужно, чтобы пользователь выбрал одно из вариантов, для этого создаётся тип перечисления.

Ниже находится перечисление о правовой сущности: юридическое лицо или физическое лицо.

```rust
enum Entity {
    /// Юридическое лицо
    LegalEntity(Formation),
    /// Физическое лицо
    Individual(Person),
    /// Индивидуальный предприниматель
    IndividualEntrepreneur(IndividualEntrepreneur),
}

/// Организационно-правовая форма
enum Formation {
    /// Общество с ограниченной ответственностью
    LLC(LLC),
}
```

Есть два типа варианта перечисления:

```rust
enum Agreed {
    /// Да
    Yes,
    /// Нет
    No,
    /// Возможно (укажите причину)
    Maybe(String),
}
```

В варианта `Yes` и `No` пользователь выбирает один кружок из списка. Вариант `Maybe(String)` помимо того, что будет выбран он сам, потребует записать и строку (т. е. `String`). Дальше это может быть использовано в шаблоне. 

3. Наследование

Если в стандарной библиотеке находится тип, который хотелось бы использовать (допустим, тип Person), но нужно добавить дополнительные данные, то для используется механизм наследования:

```rust
struct ForeignPerson: Person {
    personal_id: PersonalID;
}
```

Итого, тип ForeignPerson - это такой же Person со всеми его полями (name, surname и т. д.), но теперь он также имеет поле personal_id, которое может спрашиваться у пользователя и отрисовываться в документе.

Следует учесть, что наследоваться от типов перечислений пока что нельзя.

#### Описание данных, которые будут заполнены пользователем:

Эта часть файла должна располагаться ниже описаний данных.

Это часть файла является декларацией переменных, в которые будет осуществляться запись данных пользователя, и из которых будет происходить заполнение шаблона.

```rust
/// Кем является покупатель?
let buyer: Entity;
/// Кем является продавец?
let seller: Entity;
```

Над переменной должен находиться комментарий, который будет выводиться пользователю при заполнении этой переменной.

### Файл template.tex

Этот файл является файлов в формате LaTeX с дополнениями. За форматом обращаться на сайт <https://overleaf.com>.

В файле также находятся вставки синтаксима Minijinja, который можно прочесть по ссылке <https://docs.rs/minijinja/latest/minijinja/syntax/index.html>.

В синтаксис внесены изменения, о которых пойдёт речь дальше.

### Описание алгоритма заполнения шаблона

#### Общие советы

Если нужно повысить интерактивность заполнения шаблонов, то следует выносить отдельные поля из структур в переменные, которые будут заполнены на других шагах сценария. Например:

```rust
struct Example {
    field_one: Number,
    field_two: Number,
}

let example: Example;
```

При следующем шаге сценария:

```tex
%%(Заполнение данных)> example
```

Пользователь должен будет заполнить как `field_one`, так и `field_two`. Если эти поля являются большими, то это значительно снизит интерактивность заполнения шаблона, так как документ обновляется только между шагами.

Поэтому в таких случаях следует сделать следующим образом:

```rust
struct Example {
    field_one: Number,
}

let example: Example;
let example_field_two: Number;
```

```tex
%%(Заполнение данных)> example
%%(Заполнение дополнительных данных)> example_field_two
```

Итого, у пользователя будет два шага в сценарии, между которыми он увидит промежуточные результаты после шага `Заполнение данных`. 

#### I. Фаза подготовки

Пользователь выбрал шаблон, который он хочет заполнить. На данном этапе мы ещё не можем отправить хоть какой-либо образец готового документа, потому что не имеем никаких данных. У пользователя спрашивается определённые данные, которые он должен заполнить. Такие данные описываются в начале документа:

```tex
% $buyer$
% $seller$

\begin{document}
% ...
```

Имена переменных, которые требуется заполнить до начала следующей фазы создания шаблона, заключаются в `$`.

Как только пользователь заполнит эти переменные, отрисуется первый pdf-файл и начнётся следующая фаза.

#### II. Фаза конструктора

Основная фаза сценария-шаблона. 

## Стандартная библиотека типов:

### Person

### Place

### Passport

### String

### Number

### Date

### CadastralNumber

### Cost

Должно быть поле на запись прописью in_words. Может быть в нескольких валютах (рубль, евро, доллар).

### Town